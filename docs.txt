<?php

namespace App\Controllers;
use App\Cores\{Views, Validate, Flash};
use App\Services\Auth;
use App\Models\User;

class HomeController
{
    public static function index()
    {
        $user = new User();

        $data = [
            'users' => $user->all(),
        ];
        echo Views::render('home.index', $data);
    }

    public function add()
    {
        echo Views::render('home.add');
    }

    public function store()
    {
        $user = new User();

        $data = $_POST;

        $validator = new Validate();

        $validator->validate($data,[
            'username' => 'required',
            'password' => 'required'
        ]);

        if ($validator->fails()) {
            foreach ($validator->errors() as $filed => $messages) {
                foreach ($messages as $message) {
                    Flash::set("error_{$filed}",$message);
                }
            }

            header('Location: /add');
            exit;
        }

        $simpan = $user->create([
            'username' => $data['username'],
            'password' => Auth::bcrypt($data['password'])
        ]);

        if ($simpan) {
            header('Location: /');
            exit;
        }

        header('Location: /add');
        exit;
    }

    public function edit($id)
    {
        $user = new User();
        $getUser = $user->find($id);

        if (!$getUser) {
            echo 'user tidak ditemukan';
            exit;
        }

        echo Views::render('home.edit',[
            'user' => $getUser
        ]);
    }

    public function update($id)
    {
        $data = $_POST;
        $user = new User();

        $simpan = $user->update($id,[
            'username' => $data['username'],
        ]);

        if ($simpan) {
            header('Location: /');
            exit;
        }

        echo "Gagal disimpan";
        exit;
    }

    public function delete($id)
    {
        $user = new User();
        $hapus = $user->delete($id);

        if ($hapus) {
            header('Location: /');
            exit;
        }

        echo "Gagal dihapus";
        exit;
    }
}

<div class="row">
    <div class="col">
        <form action="/login" method="post">
        <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" name="username" class="form-control" id="username" placeholder="Username">
            <!-- Menampilkan pesan error -->
            <?php if ($error = App\Cores\Flash::get('error_username')): ?>
                <p style="color: red;"><?php echo $error; ?></p>
            <?php endif; ?>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" name="password" class="form-control" id="password">
            <!-- Menampilkan pesan error -->
            <?php if ($error = App\Cores\Flash::get('error_password')): ?>
                <p style="color: red;"><?php echo $error; ?></p>
            <?php endif; ?>
        </div>
        <?php if ($error = App\Cores\Flash::get('login_error')): ?>
                <p style="color: red;"><?php echo $error; ?></p>
            <?php endif; ?>
        <input type="submit" class="btn btn-success" value="Login">
        </form>
    </div>
</div>

<form action="/register" method="POST">
    <label for="name">Nama:</label><br>
    <input type="text" name="name" required><br>

    <label for="username">Username:</label><br>
    <input type="text" name="username" required><br>

    <label for="password">Password:</label><br>
    <input type="password" name="password" required><br>

    <label for="nik">NIK:</label><br>
    <input type="text" name="nik"><br>

    <label for="alamat">Alamat:</label><br>
    <textarea name="alamat"></textarea><br>

    <label for="no_hp">No. HP:</label><br>
    <input type="text" name="no_hp"><br><br>

    <button type="submit">Register</button>
</form>